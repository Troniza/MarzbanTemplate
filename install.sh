#!/bin/bash

# Define colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Check if running as root
if [ "$EUID" -ne 0 ]; then 
    echo -e "${RED}Please run as root${NC}"
    exit
fi

echo -e "${YELLOW}

████████╗██████╗░░█████╗░███╗░░██╗██╗███████╗░█████╗░░░░░░░███╗░░░███╗░█████╗░██████╗░███████╗██████╗░░█████╗░███╗░░██╗
╚══██╔══╝██╔══██╗██╔══██╗████╗░██║██║╚════██║██╔══██╗░░░░░░████╗░████║██╔══██╗██╔══██╗╚════██║██╔══██╗██╔══██╗████╗░██║
░░░██║░░░██████╔╝██║░░██║██╔██╗██║██║░░███╔═╝███████║█████╗██╔████╔██║███████║██████╔╝░░███╔═╝██████╦╝███████║██╔██╗██║
░░░██║░░░██╔══██╗██║░░██║██║╚████║██║██╔══╝░░██╔══██║╚════╝██║╚██╔╝██║██╔══██║██╔══██╗██╔══╝░░██╔══██╗██╔══██║██║╚████║
░░░██║░░░██║░░██║╚█████╔╝██║░╚███║██║███████╗██║░░██║░░░░░░██║░╚═╝░██║██║░░██║██║░░██║███████╗██████╦╝██║░░██║██║░╚███║
░░░╚═╝░░░╚═╝░░╚═╝░╚════╝░╚═╝░░╚══╝╚═╝╚══════╝╚═╝░░╚═╝░░░░░░╚═╝░░░░░╚═╝╚═╝░░╚═╝╚═╝░░╚═╝╚══════╝╚═════╝░╚═╝░░╚═╝╚═╝░░╚══╝

████████╗███████╗███╗░░░███╗██████╗░██╗░░░░░░█████╗░████████╗███████╗░░░░░░██╗░░░██╗░█████╗░░░░░░███╗░░░░░░░███╗░░
╚══██╔══╝██╔════╝████╗░████║██╔══██╗██║░░░░░██╔══██╗╚══██╔══╝██╔════╝░░░░░░██║░░░██║██╔══██╗░░░░████║░░░░░░████║░░
░░░██║░░░█████╗░░██╔████╔██║██████╔╝██║░░░░░███████║░░░██║░░░█████╗░░█████╗╚██╗░██╔╝██║░░██║░░░██╔██║░░░░░██╔██║░░
░░░██║░░░██╔══╝░░██║╚██╔╝██║██╔═══╝░██║░░░░░██╔══██║░░░██║░░░██╔══╝░░╚════╝░╚████╔╝░██║░░██║░░░╚═╝██║░░░░░╚═╝██║░░
░░░██║░░░███████╗██║░╚═╝░██║██║░░░░░███████╗██║░░██║░░░██║░░░███████╗░░░░░░░░╚██╔╝░░╚█████╔╝██╗███████╗██╗███████╗
░░░╚═╝░░░╚══════╝╚═╝░░░░░╚═╝╚═╝░░░░░╚══════╝╚═╝░░╚═╝░░░╚═╝░░░╚══════╝░░░░░░░░░╚═╝░░░░╚════╝░╚═╝╚══════╝╚═╝╚══════╝



${NC}"

# Define Marzban directory
MARZBAN_DIR="/var/lib/marzban"
TEMPLATE_DIR="$MARZBAN_DIR/templates/subscription"

# Create directories if they don't exist
mkdir -p "$TEMPLATE_DIR"

# Download files
echo -e "${YELLOW}

█▀▄ █▀█ █░█░█ █▄░█ █░░ █▀█ ▄▀█ █▀▄ █ █▄░█ █▀▀   █▀▀ █ █░░ █▀▀ █▀ ░ ░ ░
█▄▀ █▄█ ▀▄▀▄▀ █░▀█ █▄▄ █▄█ █▀█ █▄▀ █ █░▀█ █▄█   █▀░ █ █▄▄ ██▄ ▄█ ▄ ▄ ▄

${NC}"
wget -N -P /var/lib/marzban/templates/subscription/  https://raw.githubusercontent.com/Troniza/MarzbanTemplate/main/index.html

echo 'CUSTOM_TEMPLATES_DIRECTORY="/var/lib/marzban/templates/"' | sudo tee -a /opt/marzban/.env

echo 'SUBSCRIPTION_PAGE_TEMPLATE="subscription/index.html"' | sudo tee -a /opt/marzban/.env

marzban restart

^C

# Set permissions
chown -R marzban:marzban "$TEMPLATE_DIR"
chmod -R 644 "$TEMPLATE_DIR"/*

echo -e "${GREEN}


█ █▄░█ █▀ ▀█▀ ▄▀█ █░░ █░░ ▄▀█ ▀█▀ █ █▀█ █▄░█   █▀▀ █▀█ █▀▄▀█ █▀█ █░░ █▀▀ ▀█▀ █▀▀ █
█ █░▀█ ▄█ ░█░ █▀█ █▄▄ █▄▄ █▀█ ░█░ █ █▄█ █░▀█   █▄▄ █▄█ █░▀░█ █▀▀ █▄▄ ██▄ ░█░ ██▄ ▄


${NC}"

echo -e "Check your subscription page to see the changes , if changes are not visible please use --> ${GREEN}marzban restart${NC}"
